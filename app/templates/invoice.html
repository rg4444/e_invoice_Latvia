{% extends "base.html" %}{% block content %}
<h2>Invoice XML</h2>
<form id="set">
  <div class="mb-3">
    <textarea name="xml" rows="26" class="form-control">{{ xml }}</textarea>
  </div>
  <div class="mb-3 d-flex gap-2 flex-wrap">
    <button type="submit" class="btn btn-primary">Update Editor</button>
    <input type="file" id="file" class="form-control w-auto">
    <button id="load" class="btn btn-secondary">Load File</button>
    <button id="save" class="btn btn-secondary">Save to /data/samples/invoice-edited.xml</button>
  </div>
</form>
<script>
document.getElementById('set').addEventListener('submit', async (e)=>{
  e.preventDefault();
  const xml = e.target.elements['xml'].value;
  await fetch('/invoice/set', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({xml})});
  alert('Editor updated');
});
document.getElementById('load').addEventListener('click', async (e)=>{
  e.preventDefault();
  const f = document.getElementById('file').files[0];
  const fd = new FormData(); fd.append('file', f);
  await fetch('/invoice/load', { method:'POST', body: fd });
  location.reload();
});
document.getElementById('save').addEventListener('click', async (e)=>{
  e.preventDefault();
  await fetch('/invoice/save', { method:'POST' });
  alert('Saved to /data/samples/invoice-edited.xml');
});
</script>
{% endblock %}
